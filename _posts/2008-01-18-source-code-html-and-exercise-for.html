---
layout: post
title: Source code, HTML, and an Exercise for the Reader
date: '2008-01-18T19:57:00.001-08:00'
author: Kevin Moore
tags:
- WPF
- ".NET"
- fun
- C#
- Linq
- css
modified_time: '2008-01-18T19:57:03.061-08:00'
blogger_id: tag:blogger.com,1999:blog-2115056243892631308.post-7929922136494283973
blogger_orig_url: http://work.j832.com/2008/01/source-code-html-and-exercise-for.html
---

<p>No clue why I want to be vague about this. Probably because I'm late for a party, but really wanted to share.</p>  <p>And you're smart. You'll figure it out.</p>  <div style="font-family:monospace;"> <span style="color:#0000FF;">&lt;</span><span style="color:#A31515;">Window</span><span style="color:#0000FF;">&nbsp;</span><span style="color:#FF0000;">x:Class</span><span style="color:#0000FF;">=</span>&quot;<span style="color:#0000FF;">MainWindow</span>&quot;<br/> <span style="color:#0000FF;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#FF0000;">xmlns</span><span style="color:#0000FF;">=</span>&quot;<span style="color:#0000FF;">http://schemas.microsoft.com/winfx/2006/xaml/presentation</span>&quot;<br/> <span style="color:#0000FF;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#FF0000;">xmlns:x</span><span style="color:#0000FF;">=</span>&quot;<span style="color:#0000FF;">http://schemas.microsoft.com/winfx/2006/xaml</span>&quot;<br/> <span style="color:#0000FF;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#FF0000;">Title</span><span style="color:#0000FF;">=</span>&quot;<span style="color:#0000FF;">VS&nbsp;Copy-Paste&nbsp;to&nbsp;HTML</span>&quot;<span style="color:#0000FF;">&nbsp;&gt;</span><br/> <span style="color:#0000FF;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#A31515;">Grid</span><span style="color:#0000FF;">&gt;</span><br/> <span style="color:#0000FF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#A31515;">Grid.ColumnDefinitions</span><span style="color:#0000FF;">&gt;</span><br/> <span style="color:#0000FF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#A31515;">ColumnDefinition</span><span style="color:#0000FF;">&nbsp;</span><span style="color:#FF0000;">Width</span><span style="color:#0000FF;">=</span>&quot;<span style="color:#0000FF;">*</span>&quot;<span style="color:#0000FF;">&nbsp;/&gt;</span><br/> <span style="color:#0000FF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#A31515;">ColumnDefinition</span><span style="color:#0000FF;">&nbsp;</span><span style="color:#FF0000;">Width</span><span style="color:#0000FF;">=</span>&quot;<span style="color:#0000FF;">*</span>&quot;<span style="color:#0000FF;">&nbsp;/&gt;</span><br/> <span style="color:#0000FF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color:#A31515;">Grid.ColumnDefinitions</span><span style="color:#0000FF;">&gt;</span><br/> <span style="color:#0000FF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#A31515;">RichTextBox</span><span style="color:#0000FF;">&nbsp;</span><span style="color:#FF0000;">Name</span><span style="color:#0000FF;">=</span>&quot;<span style="color:#0000FF;">m_richTextBox</span>&quot;<span style="color:#0000FF;">&nbsp;</span><span style="color:#FF0000;">TextChanged</span><span style="color:#0000FF;">=</span>&quot;<span style="color:#0000FF;">m_richTextBox_TextChanged</span>&quot;<span style="color:#0000FF;">&nbsp;/&gt;</span><br/> <span style="color:#0000FF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color:#A31515;">TextBox</span><span style="color:#0000FF;">&nbsp;</span><span style="color:#FF0000;">Grid.Column</span><span style="color:#0000FF;">=</span>&quot;<span style="color:#0000FF;">1</span>&quot;<span style="color:#0000FF;">&nbsp;</span><span style="color:#FF0000;">Name</span><span style="color:#0000FF;">=</span>&quot;<span style="color:#0000FF;">m_textBoxHTML</span>&quot;<span style="color:#0000FF;">&nbsp;/&gt;</span><br/> <span style="color:#0000FF;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color:#A31515;">Grid</span><span style="color:#0000FF;">&gt;</span><br/> <span style="color:#0000FF;">&lt;/</span><span style="color:#A31515;">Window</span><span style="color:#0000FF;">&gt;</span><br/> <br/> </div> <div style="font-family:monospace;"> <span style="color:#0000FF;">using</span>&nbsp;System;<br/> <span style="color:#0000FF;">using</span>&nbsp;System.Collections.Generic;<br/> <span style="color:#0000FF;">using</span>&nbsp;System.Diagnostics;<br/> <span style="color:#0000FF;">using</span>&nbsp;System.Linq;<br/> <span style="color:#0000FF;">using</span>&nbsp;System.Web;<br/> <span style="color:#0000FF;">using</span>&nbsp;System.Windows;<br/> <span style="color:#0000FF;">using</span>&nbsp;System.Windows.Controls;<br/> <span style="color:#0000FF;">using</span>&nbsp;System.Windows.Documents;<br/> <span style="color:#0000FF;">using</span>&nbsp;System.Windows.Media;<br/> <br/> <span style="color:#0000FF;">public</span>&nbsp;<span style="color:#0000FF;">partial</span>&nbsp;<span style="color:#0000FF;">class</span>&nbsp;<span style="color:#2B91AF;">MainWindow</span>&nbsp;:&nbsp;<span style="color:#2B91AF;">Window</span><br/> {<br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">public</span>&nbsp;MainWindow()<br/> &nbsp;&nbsp;&nbsp;&nbsp;{<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InitializeComponent();<br/> &nbsp;&nbsp;&nbsp;&nbsp;}<br/> <br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">private</span>&nbsp;<span style="color:#0000FF;">void</span>&nbsp;m_richTextBox_TextChanged(<span style="color:#0000FF;">object</span>&nbsp;sender,&nbsp;<span style="color:#2B91AF;">TextChangedEventArgs</span>&nbsp;e)<br/> &nbsp;&nbsp;&nbsp;&nbsp;{<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_textBoxHTML.Clear();<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_textBoxHTML.AppendText(<span style="color:#A31515;">&quot;&lt;div&nbsp;style=\&quot;font-family:monospace;\&quot;&gt;&quot;</span>&nbsp;+&nbsp;<span style="color:#2B91AF;">Environment</span>.NewLine);<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">foreach</span>&nbsp;(<span style="color:#2B91AF;">Paragraph</span>&nbsp;paragraph&nbsp;<span style="color:#0000FF;">in</span>&nbsp;m_richTextBox.Document.Blocks.Cast&lt;<span style="color:#2B91AF;">Paragraph</span>&gt;())<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">foreach</span>&nbsp;(<span style="color:#2B91AF;">Run</span>&nbsp;run&nbsp;<span style="color:#0000FF;">in</span>&nbsp;Decompose(paragraph.Inlines))<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_textBoxHTML.AppendText(toCleanedColoredSpan(run));<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_textBoxHTML.AppendText(<span style="color:#A31515;">&quot;&lt;br/&gt;&quot;</span>&nbsp;+&nbsp;<span style="color:#2B91AF;">Environment</span>.NewLine);<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_textBoxHTML.AppendText(<span style="color:#A31515;">&quot;&lt;/div&gt;&quot;</span>);<br/> &nbsp;&nbsp;&nbsp;&nbsp;}<br/> <br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">private</span>&nbsp;<span style="color:#0000FF;">string</span>&nbsp;toCleanedColoredSpan(<span style="color:#2B91AF;">Run</span>&nbsp;run)<br/> &nbsp;&nbsp;&nbsp;&nbsp;{<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2B91AF;">SolidColorBrush</span>&nbsp;solidColorBrush&nbsp;=&nbsp;run.Foreground&nbsp;<span style="color:#0000FF;">as</span>&nbsp;<span style="color:#2B91AF;">SolidColorBrush</span>;<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">if</span>&nbsp;(solidColorBrush&nbsp;==&nbsp;<span style="color:#0000FF;">null</span>)<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">return</span>&nbsp;cleanString(run.Text);<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">else</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">if</span>&nbsp;(solidColorBrush.Color&nbsp;==&nbsp;<span style="color:#2B91AF;">Colors</span>.Black)<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">return</span>&nbsp;cleanString(run.Text);<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">else</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">string</span>&nbsp;colorString&nbsp;=&nbsp;solidColorBrush.Color.ToString();<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2B91AF;">Debug</span>.Assert(colorString.Length&nbsp;==&nbsp;9);<br/> <br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;colorString&nbsp;=&nbsp;colorString.Substring(3);<br/> <br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">return</span>&nbsp;<span style="color:#0000FF;">string</span>.Format(<span style="color:#A31515;">&quot;&lt;span&nbsp;style=\&quot;color:#{0};\&quot;&gt;{1}&lt;/span&gt;&quot;</span>,<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;colorString,&nbsp;cleanString(run.Text));<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/> &nbsp;&nbsp;&nbsp;&nbsp;}<br/> <br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">private</span>&nbsp;<span style="color:#0000FF;">string</span>&nbsp;cleanString(<span style="color:#0000FF;">string</span>&nbsp;source)<br/> &nbsp;&nbsp;&nbsp;&nbsp;{<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;source&nbsp;=&nbsp;<span style="color:#2B91AF;">HttpUtility</span>.HtmlEncode(source);<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;source&nbsp;=&nbsp;source.Replace(<span style="color:#A31515;">&quot;&nbsp;&quot;</span>,&nbsp;<span style="color:#A31515;">&quot;&amp;nbsp;&quot;</span>);<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">return</span>&nbsp;source;<br/> &nbsp;&nbsp;&nbsp;&nbsp;}<br/> <br/> &nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">private</span>&nbsp;<span style="color:#0000FF;">static</span>&nbsp;<span style="color:#2B91AF;">IEnumerable</span>&lt;<span style="color:#2B91AF;">Run</span>&gt;&nbsp;Decompose(<span style="color:#2B91AF;">IEnumerable</span>&lt;<span style="color:#2B91AF;">Inline</span>&gt;&nbsp;inlines)<br/> &nbsp;&nbsp;&nbsp;&nbsp;{<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">foreach</span>&nbsp;(<span style="color:#2B91AF;">Inline</span>&nbsp;inline&nbsp;<span style="color:#0000FF;">in</span>&nbsp;inlines)<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">if</span>&nbsp;(inline&nbsp;<span style="color:#0000FF;">is</span>&nbsp;<span style="color:#2B91AF;">Span</span>)<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">foreach</span>&nbsp;(<span style="color:#2B91AF;">Run</span>&nbsp;run&nbsp;<span style="color:#0000FF;">in</span>&nbsp;Decompose(((<span style="color:#2B91AF;">Span</span>)inline).Inlines))<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">yield</span>&nbsp;<span style="color:#0000FF;">return</span>&nbsp;run;<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">else</span>&nbsp;<span style="color:#0000FF;">if</span>&nbsp;(inline&nbsp;<span style="color:#0000FF;">is</span>&nbsp;<span style="color:#2B91AF;">Run</span>)<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">yield</span>&nbsp;<span style="color:#0000FF;">return</span>&nbsp;(<span style="color:#2B91AF;">Run</span>)inline;<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">else</span><br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000FF;">throw</span>&nbsp;<span style="color:#0000FF;">new</span>&nbsp;<span style="color:#2B91AF;">NotSupportedException</span>();<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/> &nbsp;&nbsp;&nbsp;&nbsp;}<br/> }<br/> </div>  