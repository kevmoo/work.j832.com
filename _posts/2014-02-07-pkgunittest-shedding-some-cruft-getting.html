---
layout: post
title: 'pkg/unittest: shedding some cruft, getting some awesome'
date: '2014-02-07T09:17:00.001-08:00'
author: Kevin Moore
tags:
- dartlang
- unittest
- dart
- unit testing
- testing
- test
modified_time: '2014-02-07T21:55:58.908-08:00'
thumbnail: http://4.bp.blogspot.com/-VPuHWCF_jqo/UvURWg2mQGI/AAAAAAAAARU/xhHZ7u4ShXM/s72-c/unittest_the_things.png
blogger_id: tag:blogger.com,1999:blog-2115056243892631308.post-3126174522643749939
blogger_orig_url: http://work.j832.com/2014/02/pkgunittest-shedding-some-cruft-getting.html
---

<div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-VPuHWCF_jqo/UvURWg2mQGI/AAAAAAAAARU/xhHZ7u4ShXM/s1600/unittest_the_things.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-VPuHWCF_jqo/UvURWg2mQGI/AAAAAAAAARU/xhHZ7u4ShXM/s1600/unittest_the_things.png" height="300" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><br /><div style="text-align: center;"><b>9:15am 7 Feb, 2014 These changes have not been released to the <a href="http://pub.dartlang.org/packages/unittest">pub site</a> yet.</b></div><br /><a href="http://en.wikipedia.org/wiki/Wikipedia:Too_long;_didn't_read">tl;dr</a><br /><ul><li>If you're testing code using Future, Stream, or anything async, you'll notice a lot fewer crashes and a lot more helpful stack traces.</li><li>If you're subclassing <a href="https://api.dartlang.org/apidocs/channels/stable/#unittest/unittest.Configuration">Configuration</a>, keep reading.</li><li>If you're using APIs on <a href="https://api.dartlang.org/apidocs/channels/stable/#unittest/unittest.TestCase">TestCase</a>, keep reading.</li><li>If you're just using test, group, expect, etc. you're likely fine.</li><li>Update pub dependencies on unittest to includes 0.10.0 to get the new hotness. (You might have something like <code>&gt;=0.9.0 &lt; 0.10.0</code>, change it to <code>&gt;=0.9.0 &lt;0.11.0</code>)</li></ul>The upcoming 0.10.0 release of <a href="http://pub.dartlang.org/packages/unittest">unittest</a> will have a lot of changes. Here's a copy-paste of<a href="https://github.com/dart-lang/bleeding_edge/blob/master/dart/pkg/unittest/CHANGELOG.md"> the current changelog</a>.<br /><ul><li>Each test is run in a separate <code>Zone</code>. This ensures that any exceptions that occur is async operations are reported back to the source test case.</li><li><strong>DEPRECATED</strong> <code>guardAsync</code>, <code>protectAsync0</code>, <code>protectAsync1</code>, and <code>protectAsync2</code><ul><li>Running each test in a <code>Zone</code> addresses the need for these methods.</li></ul></li><li><code>TestCase</code>: <ul><li>Removed properties: <code>setUp</code>, <code>tearDown</code>, <code>testFunction</code></li><li><code>enabled</code> is now get-only</li><li>Removed methods: <code>pass</code>, <code>fail</code>, <code>error</code></li></ul></li><li><code>interactive_html_config.dart</code> has been removed.</li><li><code>runTests</code>, <code>tearDown</code>, <code>setUp</code>, <code>test</code>, <code>group</code>, <code>solo_test</code>, and <code>solo_group</code> now throw a <code>StateError</code> if called while tests are running.</li><li><code>rerunTests</code> has been removed.</li></ul><div>These changes cover three big areas:</div><div><ul><li>Remove unsupported APIs. The interactive test case runner hadn't been touched in a long time and it didn't support a number core test case features, like <b>setUp</b> and <b>TearDown</b>. The <b>rerunTests</b> function only existed to support the interactive runner and introduce a lot of weird state in <b>unittest</b>.</li><li>Make <b>TestCase</b> immutable. Expect more changes here. <b>TestCase</b> should contain the logic to run the test. The result of the run should be in another object. We're getting there.</li><li>Make testing async code easier. All tests are now run in a <a href="https://api.dartlang.org/apidocs/channels/stable/#dart-async.Zone">Zone</a>. This means all any errors thrown by async operations are now funneled to the calling test case without requiring <b>guardAsync</b> or a <b>protectAsyncN</b> function (these are now deprecated).</li></ul><div>Going forward, we're looking into more changes:<br /><ul><li>Remove more state from TestCase. <code>enabled</code>, <code>isComplete</code>, <code>passed</code>, and <code>startTime</code> may be removed from this class and exposed somewhere else.</li><li>I'm hoping to have a model where TestCase exposes <code>Future&lt;TestResult&gt; run([Configuration config])</code> or similar.</li><li>More powerful ways to run unit tests, making it easy to run tests is parallel in zones, for example.</li></ul><div>I'd like <b>unittest</b> to evolve to expose a very simple API that others can build on, with a layer of "easy" for those that just want to get something tested without a lot of ceremony.</div></div></div><div><br /></div><div>Your thoughts and suggestions are welcome!</div><div><br /></div><div>Happy hacking.</div>