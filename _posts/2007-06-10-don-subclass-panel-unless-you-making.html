---
layout: post
title: Don't subclass a Panel, unless you're making a Panel
date: '2007-06-10T14:02:00.001-07:00'
author: Kevin Moore
tags:
- WPF
modified_time: '2007-08-09T11:45:50.535-07:00'
blogger_id: tag:blogger.com,1999:blog-2115056243892631308.post-4120751683093187044
blogger_orig_url: http://work.j832.com/2007/06/don-subclass-panel-unless-you-making.html
---

<p>I have a tongue-in-cheek thing I say a lot about WPF compared to Windows Forms:</p> <blockquote> <p>In Windows Forms, there are two ways to do everything: a good way and a bad way.</p> <p>In WPF, there are ten ways to do everything: two that are amazing, 3 that are good, 1 that is bad, and 4 that suck.</p></blockquote> <p>My goal in this post is to help move people upstream towards amazing, specifically how and when to use Panel (and its subclasses).</p> <p><strong>Markup subclassing</strong></p> <p>Everytime you go into VS and create a new WPF project, you see markup subclassing. This is the <font face="Consolas">Window x:Class="WPFApplication1.Window1"</font> stuff. It allows you to associate a piece of XAML to a subclass you define in Code. There are four approved places you'll see this in WPF: Application, Window, Page, and UserControl.</p> <p>More than once, though, I've seen clever people (both outside and inside Microsoft) take this approach one step further. They want to reuse a piece of UI several times. Maybe they have a Grid defined with a set of columns, rows, and controls defined. It's pretty easy to take that Xaml-defined Grid (with all of its XML child elements), put it in it's own Xaml file, slap on an x:Class statement and start rolling. Things work great.</p> <p>Rock-n-roll, right?</p> <p>Well, not really.</p> <p><strong>Inheritance for polymorphism</strong></p> <p>I read a great internal paper at MS once--written by one of those brilliant old-guard devs with decades of perspective. The point the author pushed: use inheritance only for polymorphism. Translated: when making MyGrid, only subclass Grid if you mean for people to treat your new MyGrid just like another Grid. Code (and a user, for the most part) that deals with Grid should be able to "deal" with MyGrid without any issues.</p> <p><strong>Where things break down</strong></p> <p>So let's say you define your BadGrid Xaml like this (with an associated BadGrid.xaml.cs file with properties, events, etc):</p><pre class="code"><span style="color: rgb(0,0,255)">&lt;</span><span style="color: rgb(163,21,21)">Grid</span><span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">x:Class</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">PanelFun.BadGrid</span>"<br><span style="color: rgb(0,0,255)">    </span><span style="color: rgb(255,0,0)">xmlns</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">http://schemas.microsoft.com/winfx/2006/xaml/presentation</span>"<br><span style="color: rgb(0,0,255)">    </span><span style="color: rgb(255,0,0)">xmlns:x</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">http://schemas.microsoft.com/winfx/2006/xaml</span>"<span style="color: rgb(0,0,255)">&gt;<br>    <br>    &lt;</span><span style="color: rgb(163,21,21)">Grid.RowDefinitions</span><span style="color: rgb(0,0,255)">&gt;<br>        &lt;</span><span style="color: rgb(163,21,21)">RowDefinition</span><span style="color: rgb(0,0,255)">/&gt;<br>        &lt;</span><span style="color: rgb(163,21,21)">RowDefinition</span><span style="color: rgb(0,0,255)">/&gt;<br>        &lt;</span><span style="color: rgb(163,21,21)">RowDefinition</span><span style="color: rgb(0,0,255)">/&gt;<br>    &lt;/</span><span style="color: rgb(163,21,21)">Grid.RowDefinitions</span><span style="color: rgb(0,0,255)">&gt;<br>    &lt;</span><span style="color: rgb(163,21,21)">Grid.ColumnDefinitions</span><span style="color: rgb(0,0,255)">&gt;<br>        &lt;</span><span style="color: rgb(163,21,21)">ColumnDefinition</span><span style="color: rgb(0,0,255)">/&gt;<br>        &lt;</span><span style="color: rgb(163,21,21)">ColumnDefinition</span><span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Width</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">100</span>"<span style="color: rgb(0,0,255)">/&gt;<br>    &lt;/</span><span style="color: rgb(163,21,21)">Grid.ColumnDefinitions</span><span style="color: rgb(0,0,255)">&gt;<br><br>    &lt;</span><span style="color: rgb(163,21,21)">Label</span><span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Grid.Row</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">0</span>"<span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Grid.Column</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">0</span>"<span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Content</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">_First Name</span>"<span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Target</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">{Binding ElementName=FirstName}</span>"<span style="color: rgb(0,0,255)"> /&gt;<br>    &lt;</span><span style="color: rgb(163,21,21)">TextBox</span><span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Grid.Row</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">0</span>"<span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Grid.Column</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">1</span>"<span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Name</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">FirstName</span>"<span style="color: rgb(0,0,255)"> /&gt;<br><br>    &lt;</span><span style="color: rgb(163,21,21)">Label</span><span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Grid.Row</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">1</span>"<span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Grid.Column</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">0</span>"<span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Content</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">_Middle Name</span>"<span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Target</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">{Binding ElementName=MiddleName}</span>"<span style="color: rgb(0,0,255)"> /&gt;<br>    &lt;</span><span style="color: rgb(163,21,21)">TextBox</span><span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Grid.Row</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">1</span>"<span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Grid.Column</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">1</span>"<span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Name</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">MiddleName</span>"<span style="color: rgb(0,0,255)"> /&gt;<br><br>    &lt;</span><span style="color: rgb(163,21,21)">Label</span><span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Grid.Row</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">2</span>"<span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Grid.Column</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">0</span>"<span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Content</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">_Last Name</span>"<span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Target</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">{Binding ElementName=LastName}</span>"<span style="color: rgb(0,0,255)"> /&gt;<br>    &lt;</span><span style="color: rgb(163,21,21)">TextBox</span><span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Grid.Row</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">2</span>"<span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Grid.Column</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">1</span>"<span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Name</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">LastName</span>"<span style="color: rgb(0,0,255)"> /&gt;<br><br>&lt;/</span><span style="color: rgb(163,21,21)">Grid</span><span style="color: rgb(0,0,255)">&gt;<br></span></pre><a href="http://11011.net/software/vspaste"></a><br /><p>Looks okay, right?</p><br /><p>Let's use it.</p><pre class="code"><span style="color: rgb(0,0,255)">&lt;</span><span style="color: rgb(163,21,21)">Window</span><span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">xmlns</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">http://schemas.microsoft.com/winfx/2006/xaml/presentation</span>"<br><span style="color: rgb(0,0,255)">    </span><span style="color: rgb(255,0,0)">xmlns:x</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">http://schemas.microsoft.com/winfx/2006/xaml</span>"<br><span style="color: rgb(0,0,255)">    </span><span style="color: rgb(255,0,0)">xmlns:local</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">clr-namespace:PanelFun</span>"<span style="color: rgb(0,0,255)">&gt;<br></span><span style="color: rgb(0,0,255)"></span></pre><pre class="code"><span style="color: rgb(0,0,255)">    &lt;</span><span style="color: rgb(163,21,21)">local:BadGrid</span><span style="color: rgb(0,0,255)">/&gt;        <br></span><span style="color: rgb(0,0,255)"></span></pre><pre class="code"><span style="color: rgb(0,0,255)">&lt;/</span><span style="color: rgb(163,21,21)">Window</span><span style="color: rgb(0,0,255)">&gt;<br></span></pre><a href="http://11011.net/software/vspaste"></a><br /><p>Run the app. No problem!</p><br /><p>Now let's say a naive user (maybe someone in your company or a customer) takes your control and sees that it's a Grid. They write this Xaml:</p><pre class="code"><span style="color: rgb(0,0,255)">&lt;</span><span style="color: rgb(163,21,21)">Window</span><span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">xmlns</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">http://schemas.microsoft.com/winfx/2006/xaml/presentation</span>"<br><span style="color: rgb(0,0,255)">    </span><span style="color: rgb(255,0,0)">xmlns:x</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)"><a href="http://schemas.microsoft.com/winfx/2006/xaml&quot;">http://schemas.microsoft.com/winfx/2006/xaml</span>"<br><span style="color: rgb(255,0,0)"></a>    xmlns:local</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">clr-namespace:PanelFun</span>"<span style="color: rgb(0,0,255)">&gt;</span></pre><pre class="code"><span style="color: rgb(0,0,255)"><br></span><span style="color: rgb(0,0,255)">    &lt;</span><span style="color: rgb(163,21,21)">local:BadGrid</span><span style="color: rgb(0,0,255)">&gt;<br>        &lt;</span><span style="color: rgb(163,21,21)">Grid.RowDefinitions</span><span style="color: rgb(0,0,255)">&gt;<br>            &lt;</span><span style="color: rgb(163,21,21)">RowDefinition</span><span style="color: rgb(0,0,255)">/&gt;<br>        &lt;/</span><span style="color: rgb(163,21,21)">Grid.RowDefinitions</span><span style="color: rgb(0,0,255)">&gt;<br><br>        &lt;</span><span style="color: rgb(163,21,21)">Label</span><span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Grid.Row</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">3</span>"<span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Grid.Column</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">0</span>"<span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Content</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">_Favorite Color</span>"<span style="color: rgb(0,0,255)">/&gt;<br>        &lt;</span><span style="color: rgb(163,21,21)">TextBox</span><span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Grid.Row</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">3</span>"<span style="color: rgb(0,0,255)"> </span><span style="color: rgb(255,0,0)">Grid.Column</span><span style="color: rgb(0,0,255)">=</span>"<span style="color: rgb(0,0,255)">1</span>"<span style="color: rgb(0,0,255)"> /&gt;<br>    &lt;/</span><span style="color: rgb(163,21,21)">local:BadGrid</span><span style="color: rgb(0,0,255)">&gt;</span></pre><pre class="code"><span style="color: rgb(0,0,255)"></span><span style="color: rgb(0,0,255)">&lt;/</span><span style="color: rgb(163,21,21)">Window</span><span style="color: rgb(0,0,255)">&gt;<br></span></pre><a href="http://11011.net/software/vspaste"></a><br /><p>Things compile fine. They are using BadGrid just like a Grid. No problem, right?</p><br /><p>The problem, of course, is that you didn't mean people to use BadGrid like a Grid. You wanted them to use it like a simple Control. Weird things happen, dogs and cats living together, mass hysteria.</p><br /><p>In this case, you get the user-created row inserted into your grid. If the user tries to put a name on the TextBlock, the compiler blows-up because of naming conflicts between the definition scope (in BadGrid.Xaml) and the usage scope (in the Window). The user has no clue why things blew up. (I'm not all that sure myself, actually.)</p><br /><p><strong>If you want to use markup subclassing, stay inside the fences</strong></p><br /><p>Application, Window, Panel, UserControl. It's pretty simple to paste your desired Xaml into a UserControl, with no unplanned weirdness.</p><br /><p>If you want to extend markup subclassing further, we should talk to <a href="http://rrelyea.spaces.live.com/">Rob</a>. He's the Xaml guy. :-)</p><br /><p><strong>If you want to do any subclassing, pick the right base class</strong></p><br /><p>In general (even if you're not using Markup subclassing), make sure you "mean it" when you use inheritance in WPF (or any object orientated framework, for that matter). If you subclass a ContentControl, do you mean people to treat it like a ContentControl all the time? Same thing for ItemsControl, Decorator, and Panel.</p><br /><p><strong>When would I subclass a Panel?</strong></p><br /><p>Well, if you want to make your own panel, start with Panel. AniTilePanel from my bag-o-tricks is a good example.</p><br /><p>You might want to subclass a bit deeper, but only in special cases.You could make OrderedStackPanel, where you introduce your own AttachedProperty: OrderedStackPanel.Order. This can be applied to items and your panel will order the items in the stack based on the property. The cool thing: without the property set, your panel should act just like StackPanel. This holds to the theory about inheritance and polymorphism.</p><br /><p>Make Sense? Sound good? Hack on!</p>